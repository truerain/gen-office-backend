# MIS > Admin > 사용자 권한 관리 API (tb_cm_user_role)

## 목적
- 관리자 화면에서 사용자-권한 매핑(`tb_cm_user_role`)을 등록/수정/삭제/조회한다.

## 범위
- 관리 대상: `tb_cm_user_role`
- 키 구성: `(user_id, role_id)`
- 사용자(`tb_cm_user`)와 권한(`tb_cm_role`)의 매핑을 관리한다.
- 삭제는 소프트 삭제(`use_yn = 'N'`)로 처리한다.

## 데이터 모델
- 테이블: `tb_cm_user_role`
- 기본키: `(user_id, role_id)`
- 필드 의미:
  - `user_id`: 사용자 ID
  - `role_id`: 권한 ID
  - `primary_yn`: 기본 권한 여부 (`Y`/`N`)
  - `use_yn`: 사용 여부 (`Y`/`N`)
  - `attribute1`~`attribute10`: 확장 필드
  - `creation_date`, `created_by`, `last_updated_date`, `last_updated_by`

## Endpoints
### 1) 사용자-권한 매핑 목록 조회
- `GET /api/mis/admin/user-roles`
- Query params
  - `userId` (optional)
  - `roleId` (optional)
  - `useYn` (optional)
  - `sort` (optional, default `user_id, role_id`)
    - 형식: `field [asc|desc]`를 콤마로 나열
    - 허용 필드: `user_id`, `role_id`, `creation_date`, `last_updated_date`

Response
```json
[
  {
    "userId": 1001,
    "roleId": 1,
    "primaryYn": "N",
    "useYn": "Y",
    "attribute1": null,
    "attribute2": null,
    "attribute3": null,
    "attribute4": null,
    "attribute5": null,
    "attribute6": null,
    "attribute7": null,
    "attribute8": null,
    "attribute9": null,
    "attribute10": null,
    "createdAt": "2026-02-24T10:00:00",
    "updatedAt": "2026-02-24T10:00:00",
    "empNo": "E1001",
    "empName": "홍길동",
    "orgName": "인사팀",
    "roleName": "관리자"
  }
]
```

### 2) 사용자-권한 매핑 단건 조회
- `GET /api/mis/admin/user-roles/{userId}/{roleId}`

Response
```json
{
  "userId": 1001,
  "roleId": 1,
  "primaryYn": "N",
  "useYn": "Y",
  "attribute1": null,
  "attribute2": null,
  "attribute3": null,
  "attribute4": null,
  "attribute5": null,
  "attribute6": null,
  "attribute7": null,
  "attribute8": null,
  "attribute9": null,
  "attribute10": null,
  "createdAt": "2026-02-24T10:00:00",
  "updatedAt": "2026-02-24T10:00:00",
  "empNo": "E1001",
  "empName": "홍길동",
  "orgName": "인사팀",
  "roleName": "관리자"
}
```

### 3) 사용자-권한 매핑 생성
- `POST /api/mis/admin/user-roles`

Request
```json
{
  "userId": 1001,
  "roleId": 1,
  "primaryYn": "N",
  "useYn": "Y",
  "attribute1": null,
  "attribute2": null,
  "attribute3": null,
  "attribute4": null,
  "attribute5": null,
  "attribute6": null,
  "attribute7": null,
  "attribute8": null,
  "attribute9": null,
  "attribute10": null
}
```

Response
```json
{
  "userId": 1001,
  "roleId": 1,
  "primaryYn": "N",
  "useYn": "Y",
  "attribute1": null,
  "attribute2": null,
  "attribute3": null,
  "attribute4": null,
  "attribute5": null,
  "attribute6": null,
  "attribute7": null,
  "attribute8": null,
  "attribute9": null,
  "attribute10": null,
  "createdAt": "2026-02-24T10:00:00",
  "updatedAt": "2026-02-24T10:00:00",
  "empNo": "E1001",
  "empName": "홍길동",
  "orgName": "인사팀",
  "roleName": "관리자"
}
```

### 4) 사용자-권한 매핑 수정
- `PUT /api/mis/admin/user-roles/{userId}/{roleId}`

Request
```json
{
  "primaryYn": "N",
  "useYn": "Y",
  "attribute1": null,
  "attribute2": null,
  "attribute3": null,
  "attribute4": null,
  "attribute5": null,
  "attribute6": null,
  "attribute7": null,
  "attribute8": null,
  "attribute9": null,
  "attribute10": null
}
```

Response
```json
{
  "userId": 1001,
  "roleId": 1,
  "primaryYn": "N",
  "useYn": "Y",
  "attribute1": null,
  "attribute2": null,
  "attribute3": null,
  "attribute4": null,
  "attribute5": null,
  "attribute6": null,
  "attribute7": null,
  "attribute8": null,
  "attribute9": null,
  "attribute10": null,
  "createdAt": "2026-02-24T10:00:00",
  "updatedAt": "2026-02-24T10:05:00",
  "empNo": "E1001",
  "empName": "홍길동",
  "orgName": "인사팀",
  "roleName": "관리자"
}
```

### 5) 사용자-권한 매핑 삭제 (비활성)
- `DELETE /api/mis/admin/user-roles/{userId}/{roleId}`
- 동작: 물리 삭제 대신 `useYn = 'N'`으로 변경한다.

Response
- `204 No Content`

## 검증 규칙
- `userId`, `roleId`는 필수.
- `useYn`은 `Y` 또는 `N`.
- `primaryYn`은 `Y` 또는 `N`.
- 동일 사용자 기준 `primaryYn = 'Y'`는 최대 1건만 허용한다.
- `primaryYn = 'Y'`로 저장/수정 시 해당 사용자에 기존 `primaryYn = 'Y'` 매핑은 `N`으로 변경한다.
- 사용자/권한이 존재하지 않으면 `404 Not Found`.
- 중복 키 `(user_id, role_id)` 생성 시 `409 Conflict`.

## 에러 응답
- 표준 에러 포맷을 유지한다.
```json
{
  "code": "CONFLICT",
  "messageKey": "user_role.duplicate",
  "message": "이미 존재하는 사용자-권한 매핑입니다",
  "locale": "ko",
  "path": "/api/mis/admin/user-roles",
  "timestamp": "2026-02-24T10:12:34+09:00",
  "traceId": null
}
```

## 보안
- 관리자 권한(예: `ROLE_ADMIN` 또는 운영 정책에 맞는 권한)만 접근 가능.
